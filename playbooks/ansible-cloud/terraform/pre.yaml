---
- hosts: all
  tasks:
    - name: Get current Terraform version
      uri:
        url: https://checkpoint-api.hashicorp.com/v1/check/terraform
      register: response

    - name: Set current Terraform version and download url
      set_fact:
        current_version: "{{ response.json.current_version }}"
        download_url: "{{ response.json.current_download_url }}"

    - name: Install Terraform
      unarchive:
        remote_src: true
        src: "{{ download_url }}/terraform_{{ current_version }}_linux_amd64.zip"
        dest: /usr/local/bin
      become: true
